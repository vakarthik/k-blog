[{"content":"A lot has changed in my homelab this year. Most folks in r/homelab start from Pi or a NAS / router to a mini-datacenter at home. But things were quite opposite in my case. I have downsized my homelab to a small network cabinet. Two servers are powered off and one got faulty. Things have shifted to small synology DS920+. pfsense is replaced by mikrotik hex S router.\nMain reason for downsizing are,\nTime: I couldn\u0026rsquo;t find enough time to tinker my k3s cluster, due to my work. Things keep breaking and needed lot of time to fix it. Especially when your selfhosted DNS is not working and your whole house internet is gone!\nMoney: The server hardware is not cheap in India! we don\u0026rsquo;t have a r/homelabsales 😞. The cost of UPS, batteries, servers, racks are not cheap. Also used server hardware is not available other than metro cities. Things get even more complicated when your used server has a motherboard or power supply fault.\nSpace: We do not have garages or underground spaces like the ones we see in r/homelab. A seperate room is need for homelab. Trust me!\nBut the things i have learned during the time with those big, loud servers are something wouldn\u0026rsquo;t have been possible otherwise. I wish one day all the time, money and space constraints get resolved and i have a full 42U rack at home!\nUntil then, this is the current state of my homelab.\nSince the synology is limited in terms of memory and processing power, I haved moved a few stuff to the cloud. Using nextdns for family DNS and bitwarden premium instead of selfhosting vaultwarden. Not using plex / jellyfin.\nSo far so good. The only thing pending is a fool-proof automated backup system. Recently got a 1 TB storagebox from hetzner. Planning to sync between my devices and NAS, and borg-backup important stuff to hetzner box.\n","permalink":"https://vakarthik.com/posts/2022/state-of-homelab-2022/","summary":"A lot has changed in my homelab this year. Most folks in r/homelab start from Pi or a NAS / router to a mini-datacenter at home. But things were quite opposite in my case. I have downsized my homelab to a small network cabinet. Two servers are powered off and one got faulty. Things have shifted to small synology DS920+. pfsense is replaced by mikrotik hex S router.\nMain reason for downsizing are,","title":"State of Homelab 2022"},{"content":"Many people reacted to the announcement by microsoft to stop support for IE on twitter recently. It felt nostalgic for me too.\nI first started using a PC around 1998-99. I was in 6th grade maybe. As far as I could remember, it had Samsung samtron CRT monitor, a CPU with some intel processor, 40 GB IDE hard disk and a Dax make dial-up modem connected to PCI card.\nWe had a BSNL landline at home in those days. I came across a flyer from BSNL saying, they had launched dial-up internet service in the name of sancharnet. It was just Rs.6/- per hour. I don’t remember how the connection was activated but i had internet access!! (at whooping speed of 56kbps!)\nEveryday i used for browse for some 30 minutes. When I press the connect button, there will be some dialing sounds from modem and after some time the connection will be through. Those were some adrenaline pumping moments, only people who have used dialup can appreciate.\nOne day, IE said there is an update. I clicked on download button. I had a magical download accelerator plus (DAP) which I believed was actually speeding up the downloads. I don’t even remember the versions. I think the update was IE 5 or 6. The downloads speeds will be in the order of 2-3kBps. So i downloaded the update for nearly 20 days, spending around 30-45 mins daily. The DAP also had a magical pause button, which i can resume later. I would not even browse anything when it was downloading, just to see 3 kBps. And then the update got downloaded after eternity, i installed it and had a great sense of achievement. I didn’t know it was the same crap IE at that time.\nThe big shock came when the first month bill arrived. It was around 2k, which was a huge amount in those days. I had fought with my mom saying that i was not responsible for the bill, instead the STD calls she made to her brother was the reason.\nAfter a long long time i realized that it was not just Rs.6/- per hour, but Rs.6 along with call charges for the period 🤯. Damn you marketing genius who cleverly did the flyer. I was just a kid!!\n","permalink":"https://vakarthik.com/posts/2022/how-i-downloaded-internet-explorer-for-2k/","summary":"Many people reacted to the announcement by microsoft to stop support for IE on twitter recently. It felt nostalgic for me too.\nI first started using a PC around 1998-99. I was in 6th grade maybe. As far as I could remember, it had Samsung samtron CRT monitor, a CPU with some intel processor, 40 GB IDE hard disk and a Dax make dial-up modem connected to PCI card.\nWe had a BSNL landline at home in those days.","title":"How I Downloaded IE for 2k"},{"content":"Reasons for moving I have been using iPhone for more than 5 years. It started from iPhone 4, 5s, 7, XR etc., iOS is solid and over last few years android has really caught up (not referring UI but stability and usability). Also over the last few years there have been multiple occasions were big tech use our data more and more for personalised ads.\nI wanted to move to a privacy friendly OS. I have switched from Windows to Linux completely (both laptop and desktop) and using it as a daily driver for the past one year. In iOS there is a little you could do to customise settings, and you just have to trust apple with everything. I really like the concept of having controls in our hands. Fine grain controls are possible with android and its apps, but I do not want to leave one big tech and join another. It wouldn\u0026rsquo;t help the motive for my switch.\nI looked at pinephone, and its availabilty in India is a big question. So with not much of an option left, i was looking for custom ROMs in xda forum and other places.\n(for those of you intrested in privacy, check the techlore and intel techniques )\nHopping on to CalyxOS I somehow stumbled upon grapheneos and calyxos. I did some research ( video-1 video-2 ) and finally settled with calyxos. One main reason is usability of some google apps in calyxos over graphene. Also i do not want to jump into privacy express, but take some baby steps to see where it leads.\nI bought a new Pixel 4a from flipkart during offers. It costs around 25k plus I got google nest for free. So i powered my pixel, just skipped all setup steps wherever possible and cliked on build number few to become developer, and then my heart burst when i saw \u0026lsquo;OEM unlocking ' option grayed out. After a quick google search, i did a factory reset which enabled the \u0026lsquo;OEM unlocking\u0026rsquo; option. Then you follow standard installation procedure detailed in calyx website. Just few simple steps.\nEsim migration woes There are plenty of tutorials when you search in google for esim migration. But still I took more than 2 attempts to correct a simple mistake I made. I even went on to read official manual from gsm, which was meant for telecom operators.\nStep 1. From old mobile send the following SMS to 199. You will receive a 19 digit eSIM number 32 digit activation code. GETESIM \u0026lt;EID of new phone\u0026gt; \u0026lt;IMEI of new phone\u0026gt; Step 2. Send the following SMS from old mobile to 199 SIMCHG \u0026lt;19 digit eSIM no. received after doing step 1\u0026gt; Sleep (2) hrs Step 3. Confirm by sending SMS \u0026#39;1\u0026#39; to 183 Step 4. Enter the 19 digit eSIM code during Activation call Step 5. Add mobile data plan in your phone, and enter the activation code manually in the following format. LPA:1$smdprd.jio.com$Activationcode (note: only for jio, other operators, check the respective website) Now your eSIM will get activated successfully. All the tutorials out there are just copy paste from someone and none of them clearly mention you should send EID of new phone (although it\u0026rsquo;s kind of obvious, i did mistake twice). Also note as per GSM manual the activation code need not be exactly 32 characters. There are different formats.\nSetting up as a daily driver This is my primary phone and I set it up so that it is more usable and as private as possible.\nCamera Download the GCam app from xda forum. It is much better than default camera and other camera apps.\nMicrog, Aurora store and google account I tried using microg without a google account at first. But since Aurora Store uses a random gmail to login, and the gmail account is created in a different country, some specific apps to India are not listed in store.\nI quickly created a throwaway gmail address with false details and using it for this purpose. I would also advise you to do the same since many apps related banking won\u0026rsquo;t be available on F-Droid.\nVPN Tried two to three different VPN and settled with Windscribe (referral link). Got this in Black Friday offer, $30 per year pro account. It had three servers in India with good speeds. The server in Chennai seems to be down since 10 days. I am using Pune or Mumbai. I do not use VPN for work profile. The email provider has Geo restrictions in place. Whenever the VPN chooses some other country, and email client checks mail using IMAP, bam i get a blocked notification from email provider. So better I use Work profile without VPN and turn it off after work.\nUsable apps Some apps which I find very useful, apart from default, popular and well known apps. (some are in f-driod and some are in play store)\nAntennapod - Podcasts\nBackdrops - Wallpapers\nBromite - Browser FeedMe - Feed Reader\nGenius Scan - Scanner App\nInfinity - Reddit Client\nQKSMS - SMS\nOpenWeather - Weather\nSimplelogin - Email Alias (I have a pro account grabbed during BF)\nObsidian - Notes\nSyncthing - Sync (for camera and notes folder sync)\nTermux - Terminal emulator\nI have linked an article containing some very useful apps in f-droid store.\nApps working and not working The only app which i used in iPhone and not working in calyxos is Google pay. Apart from that i use Yono SBI, BHIM, Kite and all other apps work well so far without any issues (3 months as of this writing).\nI really hate that google has put phone number in first and UPI ID as second. I mean many of my friends have no idea of their UPI ID. They just say Gpay me. 😞\nOther than this i really miss Android Auto.\nApps i wish i have not installed Google does some things so well, for which there is no real replacement. One example is Google Maps. Although Apple Maps is catching up fast, it has a long way to go in India. It is true for all other open source map apps out there. If you are in India, just install google maps. No alternatives as of now.\nAnd since my work requires whatsapp and google meet, i have installed both of them. I wanted to get rid of whatsapp badly, but work updates are done in whatsapp groups. 😑\nConclusion Overall I am happy with the switch. Now I can control which apps will go through VPN and which apps will not even have Internet access, using built-in Datura firewall, which was out of scope in iOS. Not to mention calyx is pretty stable on pixel devices.\nHope there is some useful information for you above. I hope one day i will clear all my digital tracks and use OS like graphene as a daily driver. 😃\n","permalink":"https://vakarthik.com/posts/2021/moving-to-calyxos-iphone/","summary":"Reasons for moving I have been using iPhone for more than 5 years. It started from iPhone 4, 5s, 7, XR etc., iOS is solid and over last few years android has really caught up (not referring UI but stability and usability). Also over the last few years there have been multiple occasions were big tech use our data more and more for personalised ads.\nI wanted to move to a privacy friendly OS.","title":"Moving to CalyxOS from iPhone/iOS"},{"content":"My homelab was running on a single dell r210. It had pfsense and few VMs, all the self-hosted apps were deployed using docker. Things were running fine for more than a year but i was missing high-availability, since i had only one server. I wanted my services to be available always! To achieve high availability on proxmox you need 3 servers minimum. Thus the hunt for 2 more began!\nHardware Upgrades Many say olx is a bad place and full of scammers. But i never thought i would find good and genuine deals there, especially for servers. Back in september 2020, i came across a deal for Dell R520 server with dual hex-core processor and 128GB of memory for 35k! The deal was posted by IT manager of a small firm in bangalore, and seems they were upgrading. I got 2 Dell R520 with 64GB of RAM and dual hex-core processor for 65k! 64gigs is more than sufficient for me. Thanks to a friend in bangalore, i could get these servers and door deliver it to me free of cost 😉\nThe server had fiber channel cards (seems they were using some SAN storage arrays), dual power supply, dual RJ45 network adapters and iDRAC v7 card. Such a sweet deal for the money. The one thing it did not have was HDD caddy. I was planning to put 5 x 2 TB HDD and make RAIDz2, so I had to shell out some extra money to buy these caddy.\nMy current homelab has the following hardware, juicing around 500W and consuming more than 200 units of electricity per month 😑 I sold the small WD MyCloud EX2 NAS since i am having plenty of drive space in my R520 and proxmox has native zfs support.\nThe Rack I enquired massrack for a 17 to 22U server rack. They told they had a 17U 1000mm depth rack which would cost around 15k. I was not interested to spend it at that time since i had already spent a lot on servers, and decided to create a own rack since my uncle had a pretty laser cutting machine in his factory. The output was somewhat ok, but the main problem was i could not get it closed due to alignment issues and there is a slight mismatch with square holes on rails. I guess i would buy a proper server rack late this year.\n  const myWidget = cloudinary.galleryWidget({ \"cloudName\": \"vakarthik\", \"mediaAssets\": [{ \"publicId\": \"Homelab/PHOTO-2021-01-27-14-57-17\", \"mediaType\": \"image\" }, { \"publicId\": \"Homelab/PHOTO-2021-01-27-14-57-29\", \"mediaType\": \"image\" }, { \"publicId\": \"Homelab/IMG_4345\", \"mediaType\": \"image\" }], \"carouselLocation\": \"bottom\", \"carouselStyle\": \"indicators\", \"container\": \"#my-gallery\" }); myWidget.render();  High Availability (HA) Dilemma Setting up a 3 node proxmox cluster is pretty stright-forward and well documented. So i quickly set-up a 3 node proxmox cluster with my 2 new servers, and time to dig into HA.\nIntially i had set up my services in a VM and made it as highly available VM in proxmox. But there was delay since the VM disk has to be moved from one node to another during failover. Then i stumbled upon docker-swarm which seems to check all the requirements. But the nerds in reddit were advising to go with kubernetes instead of docker-swarm.\nI checked a few tutorials and blogs (mentioned in reference below) and decided to go with k3s, a lightweight version of k8s created by rancher labs.\nFirst i installed rancher-ui and tried to install apps through gui. It was very confusing and i prefer yaml like in docker-compose. So i deleted rancher installation and started creating apps from plain manifests. Somehow i didn\u0026rsquo;t like helm charts also. Creating a manifest from scratch allows me to customise everything, helm charts allow customisation but, i prefer plain manifests.\nKubernetes was very strange for about a month, and those manifest files looked alien to me at first. But after trying it out and deploying more apps, i realised k8s was the way to go! If one day i decide to sell my homelab hardware due to some reasons, i can still put my apps on cloud with same manifest files (small modifications might be required) in minimal time, as almost all cloud providers have support for k8s engine.\nNow you delete a pod in k3s, it instantly spins another one. A node turns off! no problem, all the services in the failed node are started on available nodes with minimum downtime. The main issue with proxmox HA VM was not the downtime, but the reliability of re-starting services in another node when one fails. Also i use longhorn for persistant storage, which uses free space in all nodes and aggregates them into usable space for persistant-volumes.\nDual WAN and pfSense I already have a 100 Mbps FTTH from cherrinet. Since it had downtime due to cable cut issues (not often but 3-4 times a month) i wanted a backup connection. Luckily BSNL was also providing FTTH in my area. So i decided to get it and set-up dual wan in pfsesne. I downgraded cherrinet plan to 50mbps and BSNL connection is 60mbps. After some tinkering i got the dual wan working in my pfsense. It was not easy as i expected 😏 Here is how mine works. You can read more on CARP and dual WAN setup in netgate official docs, they have got detailed explanation.\nCurrent State This is my current state as of writing this blog post. I use nginx and metallb for ingress, longhorn for storage.\n Upgrades and ToDo There is always something to change and something to upgrade\nApps and Services Have to find out a way to archive all my mailboxes. Need to setup webtrees for family. And anything interesting from r/selfhosted\nBackups As of now i have not configured proper backups for persistant volumes. I am looking setting up minio or direct nfs backup to my zfs pool from inside longhorn. Also for my personal files need to automate my manual backup strategy and push important files to cloud.\nGigabit switch I had a dell powerconnect 16 port switch. The power supply (5V, 8A) on it failed and i purchased a after-market one from amazon, which worked fine for few months. At present it is not working. Need to upgrade to cisco/hp/dell 16-24 port all gigabit switch. Still looking in olx sometimes 😄\nUPS The 1kVA ups which i have is currently the only single point of failure 😨. Also the backup time is less than 30 minutes. Need to get one more 1kVA UPS and use my additional PSU in R520. Also looking at solar setup 😉 let us see\nRack Need to get proper server rack for enclosing the servers and make some arrangement to vent out the hot air from backside. Also need to put blanking panels to avoid hot and cold air mixing.\nDesktop Last one on the list, looking at AMD custom builds. This will take some time\u0026hellip;\nReference Some sites, videos which i fould very useful during building my homelab. (ofcourse there is reddit for everything else)\nrpi4cluster\nJust me and Opensource- Youtube\nTechnotim - youtube\n","permalink":"https://vakarthik.com/posts/2021/homelab-2021/","summary":"My homelab was running on a single dell r210. It had pfsense and few VMs, all the self-hosted apps were deployed using docker. Things were running fine for more than a year but i was missing high-availability, since i had only one server. I wanted my services to be available always! To achieve high availability on proxmox you need 3 servers minimum. Thus the hunt for 2 more began!\nHardware Upgrades Many say olx is a bad place and full of scammers.","title":"Homelab Upgrade 2021"},{"content":"HTTPS for Homelab When I wanted to install bitwarden_rs (now vaultwarden), i read their wiki and got struck with an idea to setup my homelab apps behind https.\nThen the hunt for reverse proxies started and i settled down with caddy after trying out nginx and traefik (both are good, but not suitable for my usecase). Caddy is a simple configurable reverse proxy and webserver. I use it as reverse proxy and HTTPS provider for all my homelab apps. I have found the configuration is much easier compared to other reverse proxies out there.\nCaddy will serve all content using HTTPS by default with its self signed SSL certificates. But i have found that all browsers do not play well and throw a warning. To make the browsers trust the self-signed SSL, you need to add the root certificate to the respective OS and browser cert store. It is very difficult to do it manually, especially for mobile devices. So I use letsencrypt wilcard certificate from my unused domain for homelab.\nLetsencrypt will issue a free ssl certificate which is trusted by all browsers. You have to prove the domain ownership to letsencrypt, that\u0026rsquo;s where http and DNS challenge comes into play. Read more about it here.\nBy default the caddy binary does not have cloudflare-dns plugin for acme DNS challenge. This is important because all my homelab services are not exposed to internet and there is no way http challenge will work.\nxcaddy is tool for compiling and installing caddy from source. (please note that this tool is still under development, but i have found it to be working without any issue)\nPlease note that to proceed you should have a VM or Container for playing around. I have a dedicated ubuntu container running for reverse proxy.\nDownoad and Install Go Go language is needed for compiling and installing caddy.\n## download go https://golang.org/doc/install wget https://golang.org/dl/go1.16.3.linux-amd64.tar.gz ## extract sudo tar -C /usr/local -xzf go1.16.3.linux-amd64.tar.gz ## add PATH env variable export PATH=$PATH:/usr/local/go/bin ## reboot check if go is installed go version Version is 1.16.3 as of writing this, so please change accordingly.\nDownload and install xcaddy Proceed to latest xcaddy releases page and download the *.deb package. Version is 0.1.9 as of writing this, so please change accordingly.\nwget https://github.com/caddyserver/xcaddy/releases/download/v0.1.9/xcaddy_0.1.9_linux_arm64.deb sudo dpkg -i xcaddy_0.1.9_linux_arm64.deb Other install methods are also listed in the github page.\nBuild Caddy with optional plugins We have downloaded pre-requesites and now we will build caddy with cloudflare-dns plugin. I have added webdav just for this tutorial purpose, feel free to delete it if you are not using it. There are many other plugins, please search and feel free to include the ones you like.\nxcaddy build \\ --with github.com/caddy-dns/cloudflare --with github.com/mholt/caddy-webdav The above command will download the caddy source and compile and create a caddy binary in the folder where you run the command.\nStarting caddy service The compiled binary file needs to be moved to correct location and a service files needs to be created.\nCreate a file /etc/systemd/system/caddy.service with the following contents.\n[Unit] Description=Caddy Documentation=https://caddyserver.com/docs/ After=network.target network-online.target Requires=network-online.target [Service] User=caddy Group=caddy ExecStart=/usr/local/bin/caddy run --environ --config /etc/caddy/Caddyfile ExecReload=/usr/local/bin/caddy reload --config /etc/caddy/Caddyfile TimeoutStopSec=5s LimitNOFILE=1048576 LimitNPROC=512 PrivateTmp=true ProtectSystem=full AmbientCapabilities=CAP_NET_BIND_SERVICE [Install] WantedBy=multi-user.target Be sure to chmod 644 the above file. create a user and group named caddy\nsudo chmod 644 /etc/systemd/system/caddy.service sudo groupadd --system caddy sudo useradd --system --gid caddy caddy Move the compiled binary to /usr/local/bin/caddy\nsudo chown root:root /usr/local/bin/caddy sudo chmod 755 /usr/local/bin/caddy Caddyfile Create a Caddyfile in /etc/caddy/Caddyfile. The following is an example configuration, and complete options and configuration can be checked in official docs.\n*.homelab.tld { tls YOUR_EMAIL tls { dns cloudflare API_KEY } @app1 host app1.homelab.tld @app2 host app2.homelab.tld handle @app1 { reverse_proxy 192.168.1.10:4000 } handle @app2 { reverse_proxy 192.168.1.11:3000 } log { output file /var/log/caddy/access.log { roll_size 10mb roll_keep 5 roll_keep_for 24h } } } The above example assumes homelab.tld domain DNS records are managed by cloudflare. When starting caddy it does ACME DNS challenge using the cloudflare DNS plugin to verify the domain ownership and then gets a wildcard SSL certificate from letsencrypt automatically.\nReference  https://caddy.community/t/how-to-use-dns-provider-modules-in-caddy-2/8148 https://www.digitalocean.com/community/tutorials/how-to-host-a-website-with-caddy-on-ubuntu-18-04 https://www.linode.com/docs/guides/compile-caddy-from-source/ https://caddyserver.com/docs/caddyfile/directives/tls  For more adventure, try your own CA.\nhttps://smallstep.com/blog/build-a-tiny-ca-with-raspberry-pi-yubikey/\n","permalink":"https://vakarthik.com/posts/2021/compiling-and-building-caddy/","summary":"HTTPS for Homelab When I wanted to install bitwarden_rs (now vaultwarden), i read their wiki and got struck with an idea to setup my homelab apps behind https.\nThen the hunt for reverse proxies started and i settled down with caddy after trying out nginx and traefik (both are good, but not suitable for my usecase). Caddy is a simple configurable reverse proxy and webserver. I use it as reverse proxy and HTTPS provider for all my homelab apps.","title":"HTTPS for Homelab using Caddy and ACME DNS"},{"content":"Intro ping 127.0.0.1\nThere are some interests which do not change! I used to write html and css in college days. I have had shared hosting accounts, VPS and so on! I still remember creating a small site for college workshop using WordPress. I learnt web development and managing VPS through youtube. I have always wanted to host on my own server and somehow have managed to do it this year. Also the recent development in smart home devices have compelled me to try it. I will share my experiences in creating a homelab here hoping it might be useful for someone, especially people from India.\nHuge thanks to these reddit communities for inspiration.\nhomelab\nselfhosted\nThe Hardware My HomeLab Configuration.\nSo you need bare metal first to do everything. I searched in google for about 3 months and decided to buy a used HP/Dell Server. Some other options were going on budget and getting a NUC, Mini PC from aliexpress etc., Finally decided to purchase used server mainly because i wanted to get the feel of it. Server \u0026amp; Rack:\nI purchased a used Dell R210II from zaco computers. Came to know about them from some posts i found in quora. The server had quad core xeon processor and 8GB of RAM without hard disk. The total cost was around Rs.32k including taxes. I then purchased a 120GB SSD from amazon and installed in it. I would highly recommend zaco computers for purchasing used servers. I contacted them through email and got prompt response. They shipped through fedex and server properly packed.\nAt the time of purchase i had no idea of what an iDRAC is! but they have put an iDRAC enterprise card in it without me specifically mentioning it. It was a surprise for me actually. Later i found it very useful for controlling noisy dell fans. So if you are going with Dell, make sure you have iDRAC card installed before you purchase.\nThe only reason for going with Dell R210 was that the length of server would fit into a network rack! I have installed my server and switch in a network rack (jumbo version) purchased from mass racks. I would also recommend mass racks if you need any network racks. Get a cantilever tray for switches. One 6U jumbo rack with cantilever tray costed around 2.7k.\nIf you are reading this, never ever install a server in a network rack! It was my idea and later i realized that it was very bad. First, the server is very heavy and coupled with rack and switches the entire arrangement is so heavy to lift and mount it on wall. Even if you mount on wall the small 4-corner support will not hold it. I have supported in front by using two extra anchor bolts from top. Second, cable management is very difficult. If you are from India i feel, It is cheap to assemble a wooden rack and rack mount angles with carpenter help. Dimensions can easily be found online. Mass racks also has wheel mounted server racks.\nSwitch, AP and Misc I had a relative coming from US and he was kind enough to carry a used Dell 16-port switch ($40 ebay) and a refurbished Tp-link EAP225 ($50 amazon).\nSo now i have a complete setup with a modem (i had already), a wifi AP, a switch and a server!\nNow let’s spin up ubuntu…\nVirtualisation with ESXi After getting my server up and running, i installed ubuntu server 18.04 on bare metal. Few days passed and already it had more than basic nginx and php. Also I felt the server hardware was not used to its full potential by using it just as a webserver. I was searching for a solution and came across VMware ESXI and bumped into the world of virtualisation. It is bare metal hypervisor. Having individual virtual machines would be easy for managing different set of software.\nI installed free version of ESXI 6.7 and after installing i created 4 VMs (pfsense, webserver, homeassistant and TIG stack).\nOne port on my server is directly connected to modem and other one two switch. I created two virtual switches, named them WAN and LAN. Only pfsense VM had two ports attached to it, and all other VMs are on LAN vswitch. pfsense had fully fledged firewall rules with SNORT and pfblockerNG enabled. It also had openVPN server running, so that i could check from remote.\nTIG stack is obvious, it had few grafana dashboards which looked awesome and telegraf collected metrics from pfsense and other devices using SNMP.\nThen I installed home-assistant and played with it for a while. It is a great piece of software for home automation lovers.\nThe webserver VM had two static sites, one my personal and other one for my uncle. They were working well with dynamic DNS and i off-loaded all the images to cloudinary. Only html,css and js loads from my server. (Still i have a 512 kbps upload speed on my ADSL connection)\nThis was going on for about three months. It was a great experience to install, configure and troubleshoot all the softwares i have mentioned above, especially pfsense and home-assistant which have some learning curve.\nThen I felt that something was missing in ESXI, and came across proxmox. After seeing a couple of videos on youtube, I decided to get rid of ESXI. Backed up some important configurations such as nginx, pfsense, home-assistant and deleted ESXI!\nSwitching to Proxmox Problem With ESXi There are lot of people who use VMWare ESXi for virtualization. But most of them manage through Vsphere and have multiple servers VSAN clusters. The vsphere license is not free. The main limitation i faced with free version of ESXi, is that there is no proper backup solution. I had to shutdown VMs and copy manually to NAS. I tried some solutions found in reddit communities and third party software, none of which served my purpose properly. Ideally i would love to take automated full backups of all my VMs, which was missing in free ESXi. Also for people with 2-3 servers in small homelab, clustering with free ESXi is not possible.\nEnter into Proxmox I went through couple of youtube videos which walked through Proxmox configuration. I then manually backed up all my important configurations in ESXi and formatted the disk and installed proxmox. After playing with proxmox I can say that the following features are enough for switching to proxmox from ESXi.\n  Auto backup: I have added my NAS backup directory as NFS mount point directly inside proxmox GUI and it takes automated backup of all my VMs every Sunday night while I sleep! such a relief.\n  Clustering: Although i don’t use it is great feature for people with multiple servers on their homelab. You can also create a HA cluster!!\n  Containers: You can add LXC containers directly through GUI, such a neat feature. i use some small services like reverse proxy, wireguard etc., in separate containers. Some also use docker with portainer.\n  Storage: You can create a ZFS pool (ah! those freenas times) inside proxmox and also you can ceph storage. I don’t use it, but many find it very useful.\n  I am using it for more than 3 months and proxmox seems to be pretty stable. No issues so far and I would highly recommend to anyone. The only problem i faced was some routing issue in default vmbr0 bridge. It was also solved after some help from reddit and a full restart.\nTypical Indian Homelab Struggle The biggest issue i was facing initially are those powercuts. I am not sure about the rest of the world, but in India we are facing frequent power cuts ranging from few minutes to hours sometimes. I had a APC Backups 600VA, which is enough for my single server and NAS but the issue was my server would reboot sometimes during power cut. I really had a nightmare when my server boots each and everytime during power cut.\nOnline UPS After doing some research, i decided to buy online-ups. The 3k-5k UPS which we normally purchase is a line-interactive UPS and they take milli-seconds for switching over. Hence sometimes if the delay more than 50 or 100 mill seconds my server starts to reboot. Online UPS is costly and getting them online is little difficult in India. I could find only this store selling APC online UPS at a good price.\nI had few contacts in chennai, and purchased a 1kVA online UPS. It is working well for the past 6 months and it costs Rs.15k. If anyone wants details send me a email. As of writing this post, my proxmox shows uptime of 157 days!\nSo in short, if you are getting a server for homelab, get an online UPS along with it.\nPortforward alternative Getting a High Speed FTTH For people in India, FTTH is still a dream especially for those who are in small cities. People in metro cities like chennai have a plenty of options and providers to choose from, whereas people in tier-2 cities have less choice and even there were no one providing in my town till 1 year back. So i finally see a 100Mbps speed on my screen, thanks to cherrinet. Although BSNL is providing FTTH in recent years, i couldn’t get in my place, since mine was few kilometers away from town.\nAnyone remember those noise from dial up modem ? (I’ll write a post someday on how i updated my IE for Rs.3k!)\nSpeed with Cons Ok, now fire stick streams 1080p without any lag but that high connection came with a problem. By default i cannot port forward. They provide a CGNAT service, so all i get is private IP on WAN interface (I cannot open standard ports like 80 443 for incoming traffic, without which my site will not be accessible from outside world.) The ONT devices don’t have any configuration and they connect using PPPoE. If i would like to portforward, i should get a static IP which will cost, around 5k per year. So after googling, i decided to create a VPN connection between my pfSense and a remote VPS where i could point my DNS and open common ports to the internet. I created a droplet in digitalocean and tried configuring openvpn in ubuntu. I faced lot of issues related to routing. (not an expert in linux and routing).\npfSense Site-to-Site VPN Then i came across a site to site VPN tutorial in pfsense docs, and immediately thought of installing pfSense in a cloud VPS. Luckily vultr has native support to pfsense and you can do a 1 click install. So after installing i had little issues with the configuration and fixed it by googling and doing some research.\nupdate: moved to linode (referral link) since they have a datacenter in Mumbai, ping is 40ms!!\nFor pointing domains to internal IP address, i need a reverse proxy, for with there is haproxy addon for pfsense. Now i have couple of services like this blog, nextcloud etc., exposed to the world. Basically this is how it all works…\nCloudflare DNS –\u0026gt; Cloudflare Firewall –\u0026gt; pfsense in cloud –\u0026gt; SNORT filtering and blocking –\u0026gt; HAProxy –\u0026gt; Open VPN Tunnel –\u0026gt; pfsense in homelab –\u0026gt; Individual services (www, nextcloud etc.,)\nOne real advantage is SNORT filters all the unwanted traffic in cloud and allows (hopefully :) ) only required traffic to pass through vpn tunnel.\nUseful Links https://www.techhelpguides.com/2017/06/12/ultimate-pfsense-openvpn-guide/\nhttps://nguvu.org/pfsense/pfsense-inbound_vpn/\nhttps://blog.devita.co/pfsense-to-proxy-traffic-for-websites-using-pfsense/\n","permalink":"https://vakarthik.com/posts/2019/homelab-2019/","summary":"Intro ping 127.0.0.1\nThere are some interests which do not change! I used to write html and css in college days. I have had shared hosting accounts, VPS and so on! I still remember creating a small site for college workshop using WordPress. I learnt web development and managing VPS through youtube. I have always wanted to host on my own server and somehow have managed to do it this year.","title":"Homelab v1"},{"content":"Full time engineer, part-time learner.\nThis site is a result of my interest towards computers, networks etc., and a memory of my lost love for photos. Also this has evolved from time to time based on my skills. When i was creating my personal site back in college days, i used to write in html and css. Now after 10 years so much has changed and i write in markdown!\nI am into selfhosting these days, thanks to the awesome reddit community. I Will try to post stuff related to homelab here.\nIf anyone wishes to ping me, reach me at vakarthik (at) tuta (dot) io\nCredits and Thanks: This site would not be possible with the plethora of great free \u0026amp; opensource apps. Thanks to the awesome development community.\nThanks to hugo, an awesome static generator and Aditya for this awesome theme.\n","permalink":"https://vakarthik.com/about/","summary":"Full time engineer, part-time learner.\nThis site is a result of my interest towards computers, networks etc., and a memory of my lost love for photos. Also this has evolved from time to time based on my skills. When i was creating my personal site back in college days, i used to write in html and css. Now after 10 years so much has changed and i write in markdown!","title":"About Me"},{"content":"        ","permalink":"https://vakarthik.com/photos/","summary":"        ","title":"Photos"}]